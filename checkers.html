<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkers Pro P2P</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --sq: calc(min(98vw, 450px) / 8); }
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; }
        #board { display: grid; grid-template-columns: repeat(8, var(--sq)); grid-template-rows: repeat(8, var(--sq)); border: 5px solid #333; margin-top: 20px; }
        .sq { width: var(--sq); height: var(--sq); display: flex; justify-content: center; align-items: center; }
        .dk { background: #4d3124; } .lt { background: #eec27e; }
        .p { width: 80%; height: 80%; border-radius: 50%; border: 2px solid rgba(0,0,0,0.4); display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 1.5rem; }
        .red { background: #d32f2f; } .blk { background: #212121; }
        .k::after { content: 'K'; color: rgba(255,255,255,0.5); }
        .sel { outline: 4px solid white; outline-offset: -2px; }
        #setup { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="setup">
        <h1 style="color:#eec27e">CHECKERS PRO</h1>
        <div id="my-id" style="font-size: 2rem; margin: 10px;">...</div>
        <input type="number" id="join-id" style="padding:12px;" placeholder="Partner ID">
        <button onclick="connect()" style="padding:12px 24px; background:#eec27e; border:none; border-radius:8px; margin-top:10px;">PLAY</button>
    </div>
    <h3 id="st" style="margin-top:20px;">WAITING...</h3>
    <div id="board"></div>

<script>
    const bEl = document.getElementById('board');
    let b = [], sel = null, turn = false, myCol = 'red', conn = null;

    const peer = new Peer(Math.floor(1000 + Math.random()*9000).toString());
    peer.on('open', id => document.getElementById('my-id').innerText = id);
    peer.on('connection', c => { conn = c; turn = true; myCol = 'red'; setup(); start(); });

    function connect() { const tid = document.getElementById('join-id').value; conn = peer.connect(tid); turn = false; myCol = 'blk'; setup(); start(); }
    function setup() { conn.on('data', d => { if(d.t==='M') { b = d.b; turn = true; draw(); } }); }
    
    function start() {
        document.getElementById('setup').style.display='none';
        b = Array(8).fill().map(() => Array(8).fill(null));
        for(let r=0; r<8; r++) for(let c=0; c<8; c++) {
            if((r+c)%2!==0) {
                if(r<3) b[r][c] = {c:'blk', k:false};
                if(r>4) b[r][c] = {c:'red', k:false};
            }
        }
        draw();
    }

    function draw() {
        bEl.innerHTML = ''; document.getElementById('st').innerText = turn ? "YOUR TURN" : "OPPONENT'S TURN";
        for(let r=0; r<8; r++) for(let c=0; c<8; c++) {
            const sq = document.createElement('div'); sq.className = `sq ${(r+c)%2===0?'lt':'dk'}`;
            if(b[r][c]) {
                const p = document.createElement('div'); p.className = `p ${b[r][c].c} ${b[r][c].k?'k':''} ${sel?.r===r&&sel?.c===c?'sel':''}`;
                sq.appendChild(p);
            }
            sq.onclick = () => {
                if(!turn) return;
                const p = b[r][c];
                if(sel) {
                    const dr = r - sel.r, dc = c - sel.c, adr = Math.abs(dr), adc = Math.abs(dc);
                    if(!p && adr <= 2 && adc === adr && (r+c)%2!==0) {
                        if(adr===1 && !b[sel.r][sel.c].k && ((myCol==='red'&&dr>0)||(myCol==='blk'&&dr<0))) return; // One-way non-king
                        if(adr===2) {
                            const mid = b[(r+sel.r)/2][(c+sel.c)/2];
                            if(!mid || mid.c === myCol) return;
                            b[(r+sel.r)/2][(c+sel.c)/2] = null;
                        }
                        b[r][c] = b[sel.r][sel.c]; b[sel.r][sel.c] = null;
                        if((myCol==='red'&&r===0)||(myCol==='blk'&&r===7)) b[r][c].k = true;
                        turn = false; sel = null; if(conn) conn.send({t:'M', b}); draw();
                    } else { sel = null; draw(); }
                } else if(p && p.c === myCol) { sel = {r,c}; draw(); }
            };
            bEl.appendChild(sq);
        }
    }
</script>
</body>
</html>