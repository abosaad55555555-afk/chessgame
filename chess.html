<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P2P Chess</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --sq: min(12vw, 52px); }
        body { background: #0d1117; color: white; font-family: sans-serif; margin:0; display: flex; flex-direction: column; align-items: center; }
        #board { display: grid; grid-template-columns: repeat(8, var(--sq)); border: 4px solid #333; margin-top: 15px; }
        .sq { width: var(--sq); height: var(--sq); display: flex; align-items: center; justify-content: center; font-size: calc(var(--sq) * 0.7); cursor: pointer; }
        .l { background: #f0d9b5; color: #b58863; } .d { background: #b58863; color: #f0d9b5; }
        .sel { background: #bbcb2b !important; }
        #setup { position: fixed; inset: 0; background: #0d1117; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn { background: #eec27e; color: #3e2e14; padding: 15px 30px; border: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="setup">
        <h1 style="color:#eec27e">CHESS</h1>
        <div id="my-id" style="font-size:3rem; margin:15px;">...</div>
        <input type="number" id="join-id" style="padding:15px; text-align:center; margin-bottom:10px; border-radius:8px;">
        <button class="btn" onclick="connect()">JOIN</button>
        <button onclick="start()" style="margin-top:20px; color:#eec27e; background:none; border:none;">Practice</button>
    </div>
    <div id="turn" style="background:#161b22; width:100%; padding:15px; text-align:center;">WAITING...</div>
    <div id="board"></div>
<script>
    const boardEl = document.getElementById('board');
    let game = [['rb','nb','bb','qb','kb','bb','nb','rb'],['pb','pb','pb','pb','pb','pb','pb','pb'],['','','','','','','',''],['','','','','','','',''],['','','','','','','',''],['','','','','','','',''],['pw','pw','pw','pw','pw','pw','pw','pw'],['rw','nw','bw','qw','kw','bw','nw','rw']];
    const icons = {'rw':'♖','nw':'♘','bw':'♗','qw':'♕','kw':'♔','pw':'♙','rb':'♜','nb':'♞','bb':'♝','qb':'♛','kb':'♚','pb':'♟'};
    let isMyTurn = true, myCol = 'w', conn = null, sel = null;
    const peer = new Peer(Math.floor(1000 + Math.random()*9000).toString());
    peer.on('open', id => document.getElementById('my-id').innerText = id);
    peer.on('connection', c => { conn = c; isMyTurn = true; myCol = 'w'; start(); });
    function connect() { const tid = document.getElementById('join-id').value; conn = peer.connect(tid); myCol = 'b'; isMyTurn = false; start(); }
    function start() { document.getElementById('setup').style.display='none'; if(conn) conn.on('data', d => { game = d.game; isMyTurn = true; render(); }); render(); }
    function render() {
        boardEl.innerHTML = ''; document.getElementById('turn').innerText = isMyTurn ? "★ YOUR TURN ★" : "OPPONENT'S TURN";
        const rows = myCol === 'b' ? [0,1,2,3,4,5,6,7] : [7,6,5,4,3,2,1,0];
        for(let r of rows) for(let c=0; c<8; c++) {
            const s = document.createElement('div'); s.className = `sq ${(r+c)%2===0?'l':'d'}`;
            if(sel && sel.r===r && sel.c===c) s.classList.add('sel');
            if(game[r][c]) { s.innerText = icons[game[r][c]]; s.style.color = game[r][c][1] === 'w' ? "white" : "black"; }
            s.onclick = () => {
                if(!isMyTurn) return;
                if(sel) {
                    game[r][c] = game[sel.r][sel.c]; game[sel.r][sel.c] = '';
                    isMyTurn = false; if(conn) conn.send({game}); sel = null; render();
                } else if(game[r][c].endsWith(myCol)) { sel = {r,c}; render(); }
            };
            boardEl.appendChild(s);
        }
    }
</script>
</body>
</html>