<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XO Pro P2P</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #0d1117; color: white; font-family: system-ui; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 90vw; max-width: 350px; aspect-ratio: 1/1; }
        .cell { background: #161b22; border: 2px solid #30363d; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 4rem; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .cell:active { transform: scale(0.95); background: #21262d; }
        .X { color: #ff7b72; } .O { color: #58a6ff; }
        #setup { position: fixed; inset: 0; background: #0d1117; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn { background: #238636; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; }
        #status { margin-bottom: 20px; font-size: 1.5rem; color: #8b949e; }
    </style>
</head>
<body>
    <div id="setup">
        <h1 style="font-size: 3rem; margin-bottom: 0;">XO PRO</h1>
        <p style="color: #8b949e;">Multiplayer Edition</p>
        <div id="my-id" style="font-size: 2.5rem; margin: 20px; color: #58a6ff; font-weight: bold;">...</div>
        <input type="number" id="join-id" style="padding:15px; border-radius:8px; border:1px solid #30363d; background:#010409; color:white; text-align:center; margin-bottom:15px;" placeholder="Friend's Code">
        <button class="btn" onclick="connect()">JOIN MATCH</button>
    </div>

    <div id="status">CONNECTING...</div>
    <div id="grid"></div>

<script>
    let cells = Array(9).fill(null), turn = false, mySym = 'X', conn = null, active = true;
    const gridEl = document.getElementById('grid');

    const peer = new Peer(Math.floor(1000 + Math.random()*9000).toString());
    peer.on('open', id => document.getElementById('my-id').innerText = id);
    peer.on('connection', c => { conn = c; turn = true; mySym = 'X'; setup(); start(); });

    function connect() {
        const tid = document.getElementById('join-id').value;
        conn = peer.connect(tid); turn = false; mySym = 'O'; setup(); start();
    }

    function setup() {
        conn.on('data', d => {
            if(d.t === 'M') { cells = d.c; turn = true; checkWin(); render(); }
            if(d.t === 'RESET') location.reload();
        });
    }

    function start() { document.getElementById('setup').style.display='none'; render(); }

    function checkWin() {
        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        for(let w of wins) {
            if(cells[w[0]] && cells[w[0]] === cells[w[1]] && cells[w[0]] === cells[w[2]]) {
                active = false;
                document.getElementById('status').innerText = cells[w[0]] + " WINS!";
                return;
            }
        }
        if(!cells.includes(null)) { active = false; document.getElementById('status').innerText = "DRAW!"; }
    }

    function render() {
        gridEl.innerHTML = '';
        if(active) document.getElementById('status').innerText = turn ? `YOUR TURN (${mySym})` : "WAITING...";
        cells.forEach((val, i) => {
            const div = document.createElement('div');
            div.className = `cell ${val||''}`;
            div.innerText = val || '';
            div.onclick = () => {
                if(turn && !cells[i] && active) {
                    cells[i] = mySym; turn = false;
                    checkWin();
                    if(conn) conn.send({t:'M', c: cells});
                    render();
                }
            };
            gridEl.appendChild(div);
        });
    }
</script>
</body>
</html>